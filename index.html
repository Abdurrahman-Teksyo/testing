<html>
<head>
    <title>Html-Qrcode Demo</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <div id="qr-reader" style="width:500px"></div>
    <div id="qr-reader-results"></div>
    <input type="file" id="qr-file-input" accept="image/*" capture="environment" />

    <script>
        function docReady(fn) {
            if (document.readyState === "complete" || document.readyState === "interactive") {
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        }

        docReady(function () {
            var resultContainer = document.getElementById('qr-reader-results');
            var lastResult, countResults = 0;

            function onScanSuccess(decodedText, decodedResult) {
                if (decodedText !== lastResult) {
                    ++countResults;
                    lastResult = decodedText;
                    console.log(`Scan result ${decodedText}`, decodedResult);
                    resultContainer.innerHTML = `Result: ${decodedText}`;
                }
            }

            // Initialize the QR scanner
            var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);

            // Handle image file input
            document.getElementById('qr-file-input').addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgData = e.target.result;
                        const html5QrCode = new Html5Qrcode("qr-reader");
                        html5QrCode.scanFile(file)
                            .then(onScanSuccess)
                            .catch(err => {
                                console.error("Error scanning file:", err);
                                resultContainer.innerHTML = "Error scanning file.";
                            });
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>
</body>
</html>
